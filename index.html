<!--
AI Travel Planner — Single-file frontend (index.html)

What this file does:
- Provides a simple form to enter origin, destination, days, budget and interests
- Sends a POST to your backend /generate endpoint
- Renders the returned JSON itinerary in a readable format

How to use (quick steps):
1) Save this file as index.html inside a new folder (e.g. frontend).
2) Edit the BACKEND_URL variable in the <script> section below if required. By default it is:
   const BACKEND_URL = "http://127.0.0.1:8080";
   Your Flask server printed it was running on port 8080 earlier, so this should work locally.

3) Start a simple static server from PowerShell (in the folder where index.html lives):
   # Windows PowerShell
   python -m http.server 5500

   Or use VS Code Live Server extension if you prefer.

4) Open the page in a browser:
   http://127.0.0.1:5500

5) Make sure your Flask backend is running (you said it runs on http://127.0.0.1:8080). Submit the form and you should see the generated itinerary.

Important notes:
- Do NOT put API keys in this file. Keep them secret in your backend only.
- When you later deploy the backend to Cloud Run (or similar), update BACKEND_URL to the HTTPS Cloud Run URL (e.g. https://your-service-xxxxx-uc.a.run.app).
- If you deploy the frontend to GitHub Pages (HTTPS), the backend MUST be HTTPS too (Cloud Run provides HTTPS). If you see "Failed to fetch" in the browser console after deploying, check for mixed-content (HTTP vs HTTPS).

Troubleshooting:
- "Failed to fetch": backend URL wrong, backend not running, or mixed-content (HTTP/HTTPS) block.
- CORS: your backend already uses flask-cors(CORS(app)), which allows all origins. If you still get CORS, check browser console and backend logs.

-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Travel Planner — Demo</title>
  <style>
    :root{--primary:#0077cc;--card:#fff;--bg:#f6f8fb}
    body{font-family:Inter,ui-sans-serif,system-ui,Arial,sans-serif;margin:0;background:var(--bg);color:#1f2937}
    header{background:var(--primary);color:#fff;padding:1.2rem;text-align:center}
    main{display:flex;gap:1.5rem;padding:1.5rem;flex-wrap:wrap;justify-content:center}
    .card{background:var(--card);padding:1rem;border-radius:10px;box-shadow:0 6px 18px rgba(16,24,40,0.06);width:420px;max-width:95%}
    label{display:block;margin:0.45rem 0;font-weight:600}
    input[type=text], input[type=number], input[type=date], select, button{width:100%;padding:0.6rem;border:1px solid #e5e7eb;border-radius:8px}
    fieldset{border:1px solid #e5e7eb;padding:0.6rem;border-radius:8px;margin-top:0.6rem}
    .row{display:flex;gap:0.75rem}
    .row > *{flex:1}
    button{background:var(--primary);color:white;border:none;cursor:pointer;margin-top:0.6rem}
    button[disabled]{opacity:0.6;cursor:not-allowed}
    #output{margin-top:0.75rem;background:#f8fafc;padding:0.9rem;border-radius:8px;white-space:pre-wrap}
    .loader{display:inline-block;border:3px solid rgba(255,255,255,0.3);border-top-color:white;border-radius:50%;width:16px;height:16px;animation:spin 1s linear infinite;vertical-align:middle;margin-left:8px}
    @keyframes spin{to{transform:rotate(360deg)}}
    .transport-list, .daily-list{margin:0;padding:0;list-style:disc;margin-left:1.25rem}
    .muted{color:#6b7280;font-size:0.95rem}
  </style>
</head>
<body>
  <header>
    <h1>AI Travel Planner — Demo</h1>
    <p class="muted">Enter trip details and get a quick itinerary generated by your backend.</p>
  </header>

  <main>
    <section class="card">
      <form id="tripForm">
        <label>Origin
          <input id="origin" type="text" value="Eluru" required />
        </label>

        <label>Destination
          <input id="destination" type="text" value="Goa" required />
        </label>

        <div class="row">
          <label>Days
            <input id="days" type="number" min="1" max="30" value="3" required />
          </label>
          <label>Budget (INR)
            <input id="budget" type="number" min="100" step="100" value="5000" required />
          </label>
        </div>

        <fieldset>
          <legend>Interests</legend>
          <label><input type="checkbox" value="Food" /> Food</label>
          <label><input type="checkbox" value="Beaches" /> Beaches</label>
          <label><input type="checkbox" value="History" /> History</label>
          <label><input type="checkbox" value="Nature" /> Nature</label>
          <label><input type="checkbox" value="Nightlife" /> Nightlife</label>
          <label><input type="checkbox" value="Museums" /> Museums</label>
        </fieldset>

        <button id="submitBtn" type="submit">Generate Itinerary</button>
      </form>
    </section>

    <section class="card">
      <h3>Generated Itinerary</h3>
      <div id="output">Fill the form and click <strong>Generate Itinerary</strong>.</div>
    </section>
  </main>

  <script>
    // ----- EDIT THIS -----
    // For local testing leave as-is if your Flask app runs on 127.0.0.1:8080
    const BACKEND_URL = "http://127.0.0.1:8080";
    // ----- END EDIT -----

    const form = document.getElementById('tripForm');
    const output = document.getElementById('output');
    const submitBtn = document.getElementById('submitBtn');

    function inr(x){
      if (x === null || x === undefined) return 'N/A';
      return '₹' + Number(x).toLocaleString('en-IN');
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const origin = document.getElementById('origin').value.trim();
      const destination = document.getElementById('destination').value.trim();
      const days = Number(document.getElementById('days').value);
      const budget = Number(document.getElementById('budget').value);
      const interests = Array.from(document.querySelectorAll('input[type=checkbox]:checked')).map(c=>c.value);

      const payload = { origin, destination, days, budget, interests };

      // UI feedback
      submitBtn.disabled = true;
      const loader = document.createElement('span'); loader.className = 'loader'; submitBtn.appendChild(loader);
      output.textContent = 'Loading itinerary...';

      try{
        const res = await fetch(BACKEND_URL + '/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!res.ok) {
          const text = await res.text();
          throw new Error(HTTP ${res.status}: ${text});
        }

        const data = await res.json();
        renderItinerary(data);
      }catch(err){
        console.error(err);
        output.innerHTML = <div style="color:#b91c1c">Request failed: ${err.message}</div>;
      }finally{
        submitBtn.disabled = false;
        if (loader.parentNode) loader.parentNode.removeChild(loader);
      }
    });

    function renderItinerary(itinerary){
      // The backend may return either the keys (summary, transport, daily_plan, total_cost) or slightly
      // different naming. We'll handle both cases robustly.
      if (!itinerary){ output.textContent = 'No itinerary received.'; return; }

      const summary = itinerary.summary || itinerary.summary_text || '';
      const transport = itinerary.transport || itinerary.transports || [];
      const daily = itinerary.daily_plan || itinerary.daily || [];
      const total = itinerary.total_cost || itinerary.total || itinerary.price || null;
      const notes = itinerary.notes || '';

      let html = '';
      if (summary) html += <h4>${escapeHtml(summary)}</h4>;

      html += <h5>Transport Options</h5>;
      if (transport.length){
        html += '<ul class="transport-list">';
        transport.forEach(t => {
          const mode = t.mode || t.name || 'Transport';
          const cost = t.cost || t.approx_cost_inr || null;
          html += <li>${escapeHtml(mode)} — ${inr(cost)}</li>;
        });
        html += '</ul>';
      } else html += '<p class="muted">No transport data</p>';

      html += <h5>Daily Plan</h5>;
      if (daily.length){
        daily.forEach(d => {
          const dayLabel = d.day !== undefined ? Day ${d.day} : '';
          const morning = d.morning || d.morn || '—';
          const afternoon = d.afternoon || d.noon || '—';
          const evening = d.evening || d.eve || '—';
          const cost = d.cost || d.cost_inr || null;

          html += <div style="margin-bottom:10px"><strong>${escapeHtml(dayLabel)}</strong>;
          html += <div>Morning: ${escapeHtml(morning)}</div>;
          html += <div>Afternoon: ${escapeHtml(afternoon)}</div>;
          html += <div>Evening: ${escapeHtml(evening)}</div>;
          html += <div>Estimated cost: ${inr(cost)}</div>;
          html += </div>;
        });
      } else html += '<p class="muted">No daily plan returned.</p>';

      if (total !== null) html += <h5>Total Estimated Cost: ${inr(total)}</h5>;
      if (notes) html += <p class="muted">${escapeHtml(notes)}</p>;

      output.innerHTML = html;
    }

    // small helper
    function escapeHtml(text){
      if (!text && text !== 0) return '';
      return String(text)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }
  </script>
</body>
</html>
